<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OneDrive Fetch Debug</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: monospace;
      padding: 24px;
      background: #f6f7f9;
      color: #222;
    }
    h1 { margin-top: 0; }
    .ok { color: green; font-weight: bold; }
    .err { color: red; font-weight: bold; }
    pre {
      background: #fff;
      padding: 12px;
      border: 1px solid #ccc;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .box { margin-bottom: 20px; }
  </style>
</head>

<body>

<h1>OneDrive JSON Fetch Debug</h1>

<div class="box">
  <strong>Status:</strong>
  <span id="status">Loadingâ€¦</span>
</div>

<div class="box">
  <strong>Raw response from OneDrive:</strong>
  <pre id="raw">â€”</pre>
</div>

<div class="box">
  <strong>Parsed value (cfg.url):</strong>
  <pre id="parsed">â€”</pre>
</div>

<script>
  // ðŸ”´ EXACT SAME LINK YOU USE IN PRODUCTION
  const ONEDRIVE_URL = "https://gist.githubusercontent.com/<user>/<gistid>/raw/rutdepth_link.json";

  (async () => {
    try {
      // cache-bust so you always get the latest file
      const url = `${ONEDRIVE_URL}&_=${Date.now()}`;

      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);

      const raw = await r.text();
      document.getElementById("raw").textContent = raw;

      // try parsing JSON
      const cfg = JSON.parse(raw);

      if (!cfg.url) {
        throw new Error("JSON parsed but 'url' field is missing");
      }

      document.getElementById("parsed").textContent = cfg.url;
      document.getElementById("status").textContent = "SUCCESS";
      document.getElementById("status").className = "ok";

    } catch (err) {
      document.getElementById("status").textContent = "FAILED";
      document.getElementById("status").className = "err";
      document.getElementById("parsed").textContent = err.message;
      console.error("OneDrive fetch failed:", err);
    }
  })();
</script>

</body>
</html>
